<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itcao.volunteer_back_system.mapper.StudentMapper">

    <!-- 分页查询学生列表 -->
    <select id="getStudentPage" resultType="com.itcao.volunteer_back_system.pojo.Student">
        SELECT s.*, p.province_name as provinceName FROM student s
        LEFT JOIN province p ON s.province_id = p.province_id
        <where>
            <if test="studentId != null and studentId != ''">AND s.student_id = #{studentId}</if>
            <if test="studentName != null and studentName != ''">AND s.student_name LIKE CONCAT('%', #{studentName},
                '%')
            </if>
            <if test="gender != null and gender != ''">AND s.gender = #{gender}</if>
            <if test="provinceId != null">AND s.province_id = #{provinceId}</if>
        </where>
        LIMIT #{offset}, #{pageSize}
    </select>

    <!-- 查询学生总数 -->
    <select id="getStudentCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM student s
        <where>
            <if test="studentId != null and studentId != ''">AND s.student_id = #{studentId}</if>
            <if test="studentName != null and studentName != ''">AND s.student_name LIKE CONCAT('%', #{studentName},
                '%')
            </if>
            <if test="gender != null and gender != ''">AND s.gender = #{gender}</if>
            <if test="provinceId != null">AND s.province_id = #{provinceId}</if>
        </where>
    </select>

    <!-- 根据ID查询学生信息 -->
    <select id="getStudentById" resultType="com.itcao.volunteer_back_system.pojo.Student">
        SELECT s.*, p.province_name as provinceName
        FROM student s
                 LEFT JOIN province p ON s.province_id = p.province_id
        WHERE s.student_id = #{id}
    </select>

    <!-- 新增学生信息 -->
    <insert id="insertStudent" parameterType="com.itcao.volunteer_back_system.pojo.Student">
        INSERT INTO student(student_id, student_name, id_card, gender, college_entrance_exam_score, province_id,
                            ranking)
        VALUES (#{studentId}, #{studentName}, #{idCard}, #{gender}, #{collegeEntranceExamScore}, #{provinceId},
                #{ranking})
    </insert>

    <!-- 更新学生信息 -->
    <update id="updateStudent" parameterType="com.itcao.volunteer_back_system.pojo.Student">
        UPDATE student
        SET student_name                = #{studentName},
            id_card                     = #{idCard},
            gender                      = #{gender},
            college_entrance_exam_score = #{collegeEntranceExamScore},
            province_id                 = #{provinceId},
            ranking                     = #{ranking}
        WHERE student_id = #{studentId}
    </update>

    <!-- 批量删除学生信息 -->
    <delete id="deleteStudents">
        DELETE FROM student WHERE student_id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper> 